<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ershi.chat.mapper.UserMsgInboxMapper">
    <resultMap id="BaseResultMap" type="com.ershi.chat.domain.UserMsgInboxEntity">
        <id column="id" jdbcType="BIGINT" property="id"/>
        <result column="uid" jdbcType="BIGINT" property="uid"/>
        <result column="room_id" jdbcType="BIGINT" property="roomId"/>
        <result column="read_msg_id" jdbcType="BIGINT" property="readMsgId"/>
        <result column="read_time" jdbcType="TIMESTAMP" property="readTime"/>
        <result column="last_msg_id" jdbcType="BIGINT" property="lastMsgId"/>
        <result column="active_time" jdbcType="TIMESTAMP" property="activeTime"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="update_time" jdbcType="TIMESTAMP" property="updateTime"/>
        <result column="is_delete" jdbcType="TINYINT" property="isDelete"/>
    </resultMap>
    <sql id="Base_Column_List">
        `id`, `uid`, `room_id`, `read_msg_id`, `read_time`, `active_time`, `create_time`, `update_time`, `is_delete`
    </sql>

    <insert id="refreshInBox">
        insert into user_msg_inbox(`uid`,`room_id`,`last_msg_id`,`active_time`)
        values
        <foreach collection="memberUidList" item="uid" separator=",">
            (#{uid},#{roomId},#{lastMsgId},#{activeTime})
        </foreach>
        on DUPLICATE key update
        `last_msg_id`=values(last_msg_id),
        `active_time`=values(active_time),
        `is_delete`=0
    </insert>
</mapper>